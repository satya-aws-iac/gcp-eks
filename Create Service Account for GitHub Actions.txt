# Set project ID
$env:PROJECT_ID="satya-k8-poc"

# Create service account
gcloud iam service-accounts create github-actions-gke `
    --display-name="GitHub Actions GKE Service Account"

# Grant necessary permissions
gcloud projects add-iam-policy-binding $env:PROJECT_ID `
    --member="serviceAccount:github-actions-gke@${env:PROJECT_ID}.iam.gserviceaccount.com" `
    --role="roles/container.admin"

gcloud projects add-iam-policy-binding $env:PROJECT_ID `
    --member="serviceAccount:github-actions-gke@${env:PROJECT_ID}.iam.gserviceaccount.com" `
    --role="roles/compute.admin"

gcloud projects add-iam-policy-binding $env:PROJECT_ID `
    --member="serviceAccount:github-actions-gke@${env:PROJECT_ID}.iam.gserviceaccount.com" `
    --role="roles/iam.serviceAccountUser"

    # Create and download key
gcloud iam service-accounts keys create gke-key.json  --iam-account=github-actions-gke@${env:PROJECT_ID}.iam.gserviceaccount.com