# Project Structure â€” gcp-eks

This document describes the repository layout, purpose of key files, and how to run the included helper scripts and workflows.

**Overview**
- Purpose: Provision a GKE cluster (migration from Autopilot to Standard), workflows for Terraform in GitHub Actions, helper scripts to generate/update Terraform files.
- Main folders: `terraform/`, `.github/workflows/`, and top-level helper scripts (`mg.ps1`, `setup-github-oidc.ps1`).

**Top-level files**
- `mg.ps1`: PowerShell helper that creates backups and writes a standard `main.tf`, `variables.tf`, and `outputs.tf` into `terraform/`. It prompts for confirmation and prints manual follow-up steps.
- `setup-github-oidc.ps1`: (optional) helper to configure GitHub OIDC for workload identity (not modified by this change).
- `COMPLETE-SETUP-GUIDE.md`, `workflow.md`: documentation and workflow notes.

**/terraform/**
- `backend.tf`: Terraform remote state backend configuration (locks and stores state remotely).
- `main.tf`: Resource definitions for VPC, Subnetwork, GKE cluster (`google_container_cluster`), node pool (`google_container_node_pool`), and service accounts.
- `variables.tf`: Input variables (project_id, region, zone, cluster_name, environment). `mg.ps1` writes a template here.
- `outputs.tf`: Outputs exported after `apply` (cluster name, endpoint, CA, node details).

Notes about `main.tf` generated by `mg.ps1`:
- The cluster uses `remove_default_node_pool = true` and creates a separate `google_container_node_pool` with `node_count = 2`.
- IP allocation uses secondary ranges for pods and services; `ip_allocation_policy` references `pods` and `services` ranges.
- Workload identity is enabled via `workload_identity_config`.

**/.github/workflows/**
- `terraform-plan.yml`: Runs `terraform init` and `terraform plan` (produces a plan artifact). Ensure secrets are set for GCP creds and `GCP_ZONE`/`GCP_REGION`.
- `terraform-apply.yml`: Applies plan (usually gated with manual approval or only on `stage/main` branches).
- `stage-validation.yml`: Optional pipeline used to validate deployments in a `stage` branch.


**Author**

- Name: Mylavarapu Satyanarayana
- Email: mllsatyanarayana@gmail.com
